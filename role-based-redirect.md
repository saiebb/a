# إعادة التوجيه حسب دور المستخدم بعد تسجيل الدخول

## الوصف
تم تنفيذ ميزة جديدة تقوم بإعادة توجيه المستخدم بعد تسجيل الدخول إلى لوحة التحكم المناسبة حسب دوره في النظام. هذا يحسن تجربة المستخدم ويسهل الوصول إلى الوظائف المناسبة لكل دور.

## الأدوار المدعومة
1. **المستخدم العادي (user)**: يتم توجيهه إلى الصفحة الرئيسية `/`
2. **المدير (manager)**: يتم توجيهه إلى لوحة تحكم المدير `/manager`
3. **المشرف (admin)**: يتم توجيهه إلى لوحة تحكم المشرف `/admin`
4. **المشرف الأعلى (super_admin)**: يتم توجيهه إلى لوحة تحكم المشرف الأعلى `/super-admin`

## الملفات التي تم تعديلها

### 1. `lib/role-redirect.ts` (ملف جديد)
- تم إنشاء وظيفة `getUserRole` للحصول على دور المستخدم من قاعدة البيانات باستخدام البريد الإلكتروني
- تم إنشاء وظيفة `getRedirectPathByRole` لتحديد مسار إعادة التوجيه بناءً على دور المستخدم

### 2. وظيفة RPC في قاعدة البيانات
- تم إنشاء وظيفة `get_user_role_by_email` للحصول على دور المستخدم بواسطة البريد الإلكتروني
- تم استخدام هذه الوظيفة لتجنب مشاكل الاستعلام المباشر من جدول المستخدمين

### 3. `components/auth/login-form.tsx`
- تم تعديل وظيفة `onSubmit` لاستخدام وظيفة `getRedirectPathByRole`
- تم إضافة رسائل تسجيل لتتبع عملية إعادة التوجيه
- تم تحسين التعامل مع الأخطاء

### 4. `middleware.ts`
- تم إضافة التحقق من صلاحيات المشرف الأعلى (super_admin)
- تم إضافة مسار `/super-admin` للمشرف الأعلى

### 5. ملفات لوحة تحكم المشرف الأعلى
- تم إنشاء `app/super-admin/layout.tsx` للتحقق من صلاحيات المشرف الأعلى
- تم إنشاء `app/super-admin/page.tsx` لعرض لوحة تحكم المشرف الأعلى
- تم إنشاء `components/super-admin/super-admin-header.tsx` لعرض رأس لوحة التحكم
- تم إنشاء `app/super-admin/users/page.tsx` لعرض صفحة إدارة المستخدمين

## كيفية العمل
1. عند تسجيل الدخول بنجاح، يتم الحصول على معرف المستخدم
2. يتم استخدام معرف المستخدم للاستعلام عن دوره من قاعدة البيانات
3. بناءً على الدور، يتم تحديد مسار إعادة التوجيه المناسب
4. يتم إعادة توجيه المستخدم إلى المسار المحدد بعد تأخير قصير (1000 مللي ثانية) لضمان تعيين الجلسة بشكل صحيح

## مثال على تدفق العمل
1. يقوم مدير بتسجيل الدخول باستخدام بريده الإلكتروني وكلمة المرور
2. يتم التحقق من صحة بيانات الاعتماد
3. يتم الحصول على دور المستخدم (manager)
4. يتم إعادة توجيه المستخدم إلى `/manager`

## التعامل مع الأخطاء
- في حالة عدم القدرة على الحصول على دور المستخدم، يتم استخدام "user" كدور افتراضي
- في حالة حدوث أي خطأ أثناء عملية إعادة التوجيه، يتم استخدام المسار الافتراضي (/)

## التحسينات المستقبلية
1. إضافة المزيد من الأدوار والمسارات المخصصة
2. تخزين تفضيلات المستخدم لصفحة البداية
3. تنفيذ إعادة توجيه أكثر تفصيلاً بناءً على الإجراءات السابقة للمستخدم
